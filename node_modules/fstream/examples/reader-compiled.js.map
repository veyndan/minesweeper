{"version":3,"sources":["reader.js"],"names":[],"mappings":"AAAA,IAAI,UAAU,QAAQ,eAAR,CAAd;AACA,IAAI,MAAM,QAAQ,KAAR,CAAV;AACA,IAAI,KAAK,QAAQ,IAAR,CAAT;AACA,IAAI,OAAO,QAAQ,MAAR,CAAX;AACA,IAAI,WAAW,CAAC,CAAhB;AACA,IAAI,MAAM,KAAK,OAAL,CAAa,SAAb,CAAV;;AAEA,IAAI,WAAW,KAAf;AACA,IAAI,QAAQ,KAAZ;;AAEA,IAAI,IAAJ,CAAS,aAAT,EAAwB,UAAU,CAAV,EAAa;;AAEnC,MAAI,IAAI,QAAQ,MAAR,CAAe,EAAE,MAAM,GAAR;AACE,YAAQ,YAAY;;AAElB,aAAO,KAAK,MAAL,KAAgB,CAAhB,IAAqB,SAAS,CAArC;AACD;AAJH,GAAf,CAAR;;AAOA,IAAE,EAAF,CAAK,OAAL,EAAc,YAAY;AACxB,eAAW,IAAX;AACA,eAAW,GAAG,WAAH,CAAe,GAAf,EAAoB,MAA/B;AACA,YAAQ,KAAR,CAAc,kCAAgC,QAA9C;AACA,MAAE,KAAF,CAAQ,EAAE,IAAV,EAAgB,WAAhB,EAA6B,uBAA7B;AACD,GALD;;AAOA,IAAE,EAAF,CAAK,OAAL,EAAc,UAAU,KAAV,EAAiB;AAC7B;AACA,QAAI,CAAC,QAAL,EAAe;AACb,QAAE,IAAF,CAAO,wBAAP;AACD;AACD,MAAE,KAAF,CAAQ,MAAM,OAAd,EAAuB,EAAE,IAAzB,EAA+B,wBAA/B;AACD,GAND;;AAQA,IAAE,EAAF,CAAK,OAAL,EAAc,UAAU,EAAV,EAAc;AAC1B,MAAE,IAAF,CAAO,EAAP;AACA,MAAE,GAAF;AACA,YAAQ,IAAR,CAAa,CAAb;AACD,GAJD;;AAMA,IAAE,EAAF,CAAK,KAAL,EAAY,YAAY;AACtB,MAAE,KAAF,CAAQ,QAAR,EAAkB,CAAlB,EAAqB,+BAArB;AACA,YAAQ,IAAR;AACD,GAHD;;AAKA,MAAI,SAAS,KAAb;AACA,IAAE,EAAF,CAAK,OAAL,EAAc,YAAY;AACxB,MAAE,EAAF,CAAK,KAAL,EAAY,sBAAZ;AACA,MAAE,KAAF,CAAQ,MAAR,EAAgB,+BAAhB;AACA,aAAS,IAAT;AACA,MAAE,GAAF;AACD,GALD;AAOD,CA3CD","file":"reader-compiled.js","sourcesContent":["var fstream = require(\"../fstream.js\")\nvar tap = require(\"tap\")\nvar fs = require(\"fs\")\nvar path = require(\"path\")\nvar children = -1\nvar dir = path.dirname(__dirname)\n\nvar gotReady = false\nvar ended = false\n\ntap.test(\"reader test\", function (t) {\n\n  var r = fstream.Reader({ path: dir\n                         , filter: function () {\n                             // return this.parent === r\n                             return this.parent === r || this === r\n                           }\n                         })\n\n  r.on(\"ready\", function () {\n    gotReady = true\n    children = fs.readdirSync(dir).length\n    console.error(\"Setting expected children to \"+children)\n    t.equal(r.type, \"Directory\", \"should be a directory\")\n  })\n\n  r.on(\"entry\", function (entry) {\n    children --\n    if (!gotReady) {\n      t.fail(\"children before ready!\")\n    }\n    t.equal(entry.dirname, r.path, \"basename is parent dir\")\n  })\n\n  r.on(\"error\", function (er) {\n    t.fail(er)\n    t.end()\n    process.exit(1)\n  })\n\n  r.on(\"end\", function () {\n    t.equal(children, 0, \"should have seen all children\")\n    ended = true\n  })\n\n  var closed = false\n  r.on(\"close\", function () {\n    t.ok(ended, \"saw end before close\")\n    t.notOk(closed, \"close should only happen once\")\n    closed = true\n    t.end()\n  })\n\n})\n"]}