{"version":3,"sources":["proxy-reader.js"],"names":[],"mappings":";;;AAGA,OAAO,OAAP,GAAiB,WAAjB;;AAEA,IAAI,SAAS,QAAQ,aAAR,CAAb;AAAA,IACI,UAAU,QAAQ,eAAR,CADd;AAAA,IAEI,WAAW,QAAQ,UAAR,CAFf;AAAA,IAGI,KAAK,QAAQ,aAAR,CAHT;;AAKA,SAAS,WAAT,EAAsB,MAAtB;;AAEA,SAAS,WAAT,CAAsB,KAAtB,EAA6B;AAC3B,MAAI,KAAK,IAAT;AACA,MAAI,EAAE,cAAc,WAAhB,CAAJ,EAAkC,MAAM,IAAI,KAAJ,CACtC,4CADsC,CAAN;;AAGlC,KAAG,KAAH,GAAW,KAAX;AACA,KAAG,OAAH,GAAa,EAAb;AACA,KAAG,KAAH,GAAW,KAAX;;AAEA,SAAO,IAAP,CAAY,EAAZ,EAAgB,KAAhB;AACD;;AAED,YAAY,SAAZ,CAAsB,KAAtB,GAA8B,YAAY;AACxC,MAAI,KAAK,IAAT;AAAA,MACI,QAAQ,GAAG;;AADf;AAAA,MAGI,OAAO,MAAM,MAAN,GAAe,MAAf,GAAwB,OAHnC;;AAKA,KAAG,IAAH,EAAS,MAAM,IAAf,EAAqB,UAAU,EAAV,EAAc,OAAd,EAAuB;AAC1C,QAAI,IAAJ;AACA,QAAI,MAAM,CAAC,OAAX,EAAoB;AAClB,aAAO,MAAP;AACD,KAFD,MAEO;AACL,aAAO,QAAQ,OAAR,CAAP;AACD;;AAED,UAAM,IAAN,IAAc,IAAd;AACA,UAAM,IAAN,GAAa,GAAG,IAAH,GAAU,IAAvB;;AAEA,OAAG,IAAH,GAAU,OAAV;AACA,OAAG,SAAH,CAAa,OAAO,KAAP,EAAc,OAAd,CAAb;AACD,GAbD;AAcD,CApBD;;AAsBA,YAAY,SAAZ,CAAsB,SAAtB,GAAkC,UAAU,KAAV,EAAiB;AACjD,MAAI,KAAK,IAAT;AACA,MAAI,GAAG,YAAP,EAAqB;AACnB,WAAO,GAAG,KAAH,CAAS,mBAAT,CAAP;AACD;;AAED,KAAG,YAAH,GAAkB,KAAlB;AACA,QAAM,MAAN,GAAe,EAAf,CAEE,CAAE,OAAF,EACE,MADF,EAEE,KAFF,EAGE,OAHF,EAIE,UAJF,EAKE,OALF,EAME,UANF,EAOE,OAPF,EAQE,UARF,EASE,MATF,EAUE,MAVF,EAWE,OAXF,CAWU,UAAU,EAAV,EAAc;;AAEtB,UAAM,EAAN,CAAS,EAAT,EAAa,GAAG,IAAH,CAAQ,IAAR,CAAa,EAAb,EAAiB,EAAjB,CAAb;AACD,GAdD;;AAgBF,KAAG,IAAH,CAAQ,OAAR,EAAiB,KAAjB;;AAEA,QAAM,EAAN,CAAS,OAAT,EAAkB,YAAY;;AAE5B,OAAG,KAAH,GAAW,IAAX;AACA,OAAG,IAAH,CAAQ,OAAR;AACD,GAJD;;AAMA,MAAI,QAAQ,GAAG,OAAf;AACA,KAAG,OAAH,CAAW,MAAX,GAAoB,CAApB;AACA,QAAM,OAAN,CAAc,UAAU,CAAV,EAAa;AACzB,UAAM,EAAE,CAAF,CAAN,EAAY,KAAZ,CAAkB,KAAlB,EAAyB,EAAE,CAAF,CAAzB;AACD,GAFD;AAGD,CAtCD;;AAwCA,YAAY,SAAZ,CAAsB,KAAtB,GAA8B,YAAY;AACxC,SAAO,KAAK,YAAL,GAAoB,KAAK,YAAL,CAAkB,KAAlB,EAApB,GAAgD,KAAvD;AACD,CAFD;;AAIA,YAAY,SAAZ,CAAsB,MAAtB,GAA+B,YAAY;AACzC,SAAO,KAAK,YAAL,GAAoB,KAAK,YAAL,CAAkB,MAAlB,EAApB,GAAiD,KAAxD;AACD,CAFD","file":"proxy-reader-compiled.js","sourcesContent":["// A reader for when we don't yet know what kind of thing\n// the thing is.\n\nmodule.exports = ProxyReader\n\nvar Reader = require(\"./reader.js\")\n  , getType = require(\"./get-type.js\")\n  , inherits = require(\"inherits\")\n  , fs = require(\"graceful-fs\")\n\ninherits(ProxyReader, Reader)\n\nfunction ProxyReader (props) {\n  var me = this\n  if (!(me instanceof ProxyReader)) throw new Error(\n    \"ProxyReader must be called as constructor.\")\n\n  me.props = props\n  me._buffer = []\n  me.ready = false\n\n  Reader.call(me, props)\n}\n\nProxyReader.prototype._stat = function () {\n  var me = this\n    , props = me.props\n    // stat the thing to see what the proxy should be.\n    , stat = props.follow ? \"stat\" : \"lstat\"\n\n  fs[stat](props.path, function (er, current) {\n    var type\n    if (er || !current) {\n      type = \"File\"\n    } else {\n      type = getType(current)\n    }\n\n    props[type] = true\n    props.type = me.type = type\n\n    me._old = current\n    me._addProxy(Reader(props, current))\n  })\n}\n\nProxyReader.prototype._addProxy = function (proxy) {\n  var me = this\n  if (me._proxyTarget) {\n    return me.error(\"proxy already set\")\n  }\n\n  me._proxyTarget = proxy\n  proxy._proxy = me\n\n  ; [ \"error\"\n    , \"data\"\n    , \"end\"\n    , \"close\"\n    , \"linkpath\"\n    , \"entry\"\n    , \"entryEnd\"\n    , \"child\"\n    , \"childEnd\"\n    , \"warn\"\n    , \"stat\"\n    ].forEach(function (ev) {\n      // console.error(\"~~ proxy event\", ev, me.path)\n      proxy.on(ev, me.emit.bind(me, ev))\n    })\n\n  me.emit(\"proxy\", proxy)\n\n  proxy.on(\"ready\", function () {\n    // console.error(\"~~ proxy is ready!\", me.path)\n    me.ready = true\n    me.emit(\"ready\")\n  })\n\n  var calls = me._buffer\n  me._buffer.length = 0\n  calls.forEach(function (c) {\n    proxy[c[0]].apply(proxy, c[1])\n  })\n}\n\nProxyReader.prototype.pause = function () {\n  return this._proxyTarget ? this._proxyTarget.pause() : false\n}\n\nProxyReader.prototype.resume = function () {\n  return this._proxyTarget ? this._proxyTarget.resume() : false\n}\n"]}