{"version":3,"sources":["link-writer.js"],"names":[],"mappings":"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","file":"link-writer-compiled.js","sourcesContent":["\nmodule.exports = LinkWriter\n\nvar fs = require(\"graceful-fs\")\n  , Writer = require(\"./writer.js\")\n  , inherits = require(\"inherits\")\n  , path = require(\"path\")\n  , rimraf = require(\"rimraf\")\n\ninherits(LinkWriter, Writer)\n\nfunction LinkWriter (props) {\n  var me = this\n  if (!(me instanceof LinkWriter)) throw new Error(\n    \"LinkWriter must be called as constructor.\")\n\n  // should already be established as a Link type\n  if (!((props.type === \"Link\" && props.Link) ||\n        (props.type === \"SymbolicLink\" && props.SymbolicLink))) {\n    throw new Error(\"Non-link type \"+ props.type)\n  }\n\n  if (props.linkpath === \"\") props.linkpath = \".\"\n  if (!props.linkpath) {\n    me.error(\"Need linkpath property to create \" + props.type)\n  }\n\n  Writer.call(this, props)\n}\n\nLinkWriter.prototype._create = function () {\n  // console.error(\" LW _create\")\n  var me = this\n    , hard = me.type === \"Link\" || process.platform === \"win32\"\n    , link = hard ? \"link\" : \"symlink\"\n    , lp = hard ? path.resolve(me.dirname, me.linkpath) : me.linkpath\n\n  // can only change the link path by clobbering\n  // For hard links, let's just assume that's always the case, since\n  // there's no good way to read them if we don't already know.\n  if (hard) return clobber(me, lp, link)\n\n  fs.readlink(me._path, function (er, p) {\n    // only skip creation if it's exactly the same link\n    if (p && p === lp) return finish(me)\n    clobber(me, lp, link)\n  })\n}\n\nfunction clobber (me, lp, link) {\n  rimraf(me._path, function (er) {\n    if (er) return me.error(er)\n    create(me, lp, link)\n  })\n}\n\nfunction create (me, lp, link) {\n  fs[link](lp, me._path, function (er) {\n    // if this is a hard link, and we're in the process of writing out a\n    // directory, it's very possible that the thing we're linking to\n    // doesn't exist yet (especially if it was intended as a symlink),\n    // so swallow ENOENT errors here and just soldier in.\n    // Additionally, an EPERM or EACCES can happen on win32 if it's trying\n    // to make a link to a directory.  Again, just skip it.\n    // A better solution would be to have fs.symlink be supported on\n    // windows in some nice fashion.\n    if (er) {\n      if ((er.code === \"ENOENT\" ||\n           er.code === \"EACCES\" ||\n           er.code === \"EPERM\" ) && process.platform === \"win32\") {\n        me.ready = true\n        me.emit(\"ready\")\n        me.emit(\"end\")\n        me.emit(\"close\")\n        me.end = me._finish = function () {}\n      } else return me.error(er)\n    }\n    finish(me)\n  })\n}\n\nfunction finish (me) {\n  me.ready = true\n  me.emit(\"ready\")\n  if (me._ended && !me._finished) me._finish()\n}\n\nLinkWriter.prototype.end = function () {\n  // console.error(\"LW finish in end\")\n  this._ended = true\n  if (this.ready) {\n    this._finished = true\n    this._finish()\n  }\n}\n"]}